@*
For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model ICollection<QuanLyLopHoc.Models.DAO.ClassReply>
@{
    var date = ViewData["deadline"];
    var deadline = ViewData["deadline"] != null ? DateTime.Parse(date.ToString()) : DateTime.MaxValue;
}
<form asp-controller="Subject" asp-action="CollectHomeworks" method="post" class="m-6 py-4 flex flex-row items-center justify-center backdrop-blur-sm bg-slate-300/30">
    <input id="PostId" class="hidden" name="PostId" value="@ViewData["PostId"]"></input>
    <div class="mx-5">
        <label for="sort" class="block mb-2 text-sm font-medium text-gray-900">Sắp xếp</label>
        <select name="sort" id="sort"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-52 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
            <option value="name" selected>Tên sinh viên</option>
            <option value="time">Thời gian nộp</option>
        </select>
    </div>
    <div>
        <label for="date" class="block mb-2 text-sm font-medium text-gray-900">Ngày nộp</label>
        <input type="datetime-local" id="date" name="date"
               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-52 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
    </div>
    <button class=" mx-5 text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 shadow-lg shadow-blue-500/50 dark:shadow-lg dark:shadow-blue-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2" type="submit">Sắp xếp</button>
</form>
@if(ViewData["deadline"]!=null){
<h1 class="text-base">Hạn trễ @(date)</h1>

}
<div class="relative overflow-x-auto">
    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
                <th scope="col" class="px-6 py-3">
                    Họ và tên
                </th>
                <th scope="col" class="px-6 py-3">
                    Email
                </th>
                <th scope="col" class="px-6 py-3">
                    Trạng thái
                </th>
                <th scope="col" class="px-6 py-3">
                    Link
                </th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null || Model.Count() > 0)
            {
                @foreach (var item in Model)
                {
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            @item.Student.FirstName @item.Student.LastName
                        </th>
                        <td class="px-6 py-4">
                            @item.Student.Email
                        </td>
                        <td class="px-6 py-4">
                            @if (item.Reply == null)
                            {
                                <p>Chưa mộp bài</p>
                            }
                            else
                            {
                                <p>Nộp lúc @item.Reply.SubmitTime.ToString("HH:mm:ss dd/MM/yyyy")</p>
                                @if (deadline != null && deadline != DateTime.MaxValue)
                                {
                                    @if ((item.Reply.SubmitTime.Subtract(deadline).TotalMinutes) > 0)
                                    {
                                        <p>Muộn @Math.Round((item.Reply.SubmitTime.Subtract(deadline).TotalMinutes), 2) phút</p>
                                    }
                                }
                            }
                        </td>
                        <td class="px-6 py-4">
                            @if (item.Reply != null)
                            {
                                <a href="@Url.Action(" ReplyHere", "Student" , new{replyId=item.Reply.Id})">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5"
                                         viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </a>
                            }
                        </td>
                    </tr>
                }
            }

        </tbody>
    </table>
</div>

<script>
    console.log('@deadline');
</script>